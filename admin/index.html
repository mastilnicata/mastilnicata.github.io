---
---
<head>
    <link href="https://unpkg.com/netlify-cms/dist/cms.css" rel="stylesheet"/>
</head>
<body>
  <script src="/admin/scripts/config.js"></script>
  <script src="https://unpkg.com/netlify-cms/dist/netlify-cms.js"></script>
  <script>
    CMS.registerPreviewStyle("styles/custom-preview.css");
    CMS.registerPreviewStyle("../assets/css/mastilnitsata.css");
    window.CMS_MANUAL_INIT = true

    var env = "{{jekyll.environment}}";
    if(!configurations[env])
    {
      env = "production";
    }
    initCMS(configurations[env]);

      var TestimonialPreview = createClass({
        render: function() {
          var entry = this.props.entry;
          var name = entry.getIn(['data', 'name']);
          name = (typeof(name) == typeof(undefined))? '' : name;
          var title = entry.getIn(['data', 'title']);
          title = (typeof(title) == typeof(undefined))? '' : title;
          var tagline = entry.getIn(['data', 'tagline']);
          tagline = (typeof(tagline) == typeof(undefined))? '' : '"' + tagline + '"';
          var content = this.props.widgetFor('body');
          var genger = entry.getIn(['data', 'genger']).toLowerCase();
          var isHiddenText = 'This testimonial is ' + ((entry.getIn(['data', 'hidden']))? 'hidden':'visible!');
          var messageClass = ((entry.getIn(['data', 'hidden']))? 'hiddenPost':'visiblePost');
          var photo = entry.getIn(['data', 'photo']);
          var photosrc = this.props.getAsset(photo).toString();
          if(!photo)
          {
            photosrc = (genger=='female')? '/assets/images/icon-woman.png':'/assets/images/icon-man.png';
          }

          var nameandtitle = name;
          nameandtitle += ((nameandtitle && title)? ", " : "") + title;

          var preview = 
            h('div', {},
              h('div', {'className': 'mt-3 ' + messageClass }, isHiddenText),
              h('div', { 'className': 'bg-dark-grey p-4 mx-auto mt-3 mb-3' }, 
                h('h1', { 'className': 'text-center'}, 'Testimonial Preview'),
                h('div', { 'className':  'carousel carousel-testimonial slide', 'id' :'carouselTestimonial' },
                  h('ol', { 'className': 'carousel-indicators'},
                    h('li', {'className': 'active', 'data-target':'#carouselTestimonial', 'data-slide-to': '0' })
                  ),
                  h('div', {'className': 'carousel-inner'},
                    h('div', {'className': 'carousel-item text-center active'},
                      h('div', {'className':'carousel-testimonial-img p-1 rounded-circle m-auto'},
                        h('img', {"className": "rounded-circle", "src": photosrc, 'alt': nameandtitle })
                      ),
                      h('h5', {'className':'mt-4 mb-0'},
                        h('strong', {'className':'text-warning'}, tagline)
                      ),
                      h('h6', {'className':'m-0'}, nameandtitle),
                      h('p', {'className':'testimonial-text m-0 pt-3'}, content)
                    )
                  )
                )
              )
          );
          return preview;
        }
      });
      CMS.registerPreviewTemplate("testimonial", TestimonialPreview);


      var ContentBlockPreview = createClass({
        render: function() {
          var entry = this.props.entry;
          var content = this.props.widgetFor('body');

          var bgColor = entry.getIn(['data', 'bg-color']);
          bgColor = (typeof(bgColor) == typeof(undefined))? 'transparent' : bgColor;
          var color = entry.getIn(['data', 'color']);
          color = (typeof(color) == typeof(undefined))? 'black' : color;
          var css = entry.getIn(['data', 'css-class']);
          css = (typeof(css) == typeof(undefined))? '' : css;

          var isHiddenText = 'This content block is ' + ((entry.getIn(['data', 'hidden']))? 'hidden':'visible!');
          var messageClass = ((entry.getIn(['data', 'hidden']))? 'hiddenPost':'visiblePost');

          
          if(content)
          {
            content.props.value = content.props.value.replace(/[\\]*\[\[mastilnicata\-logo\]\]/g, '<span class="mastilnitsata mastilnitsata-mastilnitsa-handmade"></span>');
            content.props.value = content.props.value.replace(/[\\]*\[\[mastilnicata\-m\]\]/g, '<span class="mastilnitsata mastilnitsata-mastilnitsa-handmade-M"></span>');
            content.props.value = content.props.value.replace(/[\\]*\[\[mastilnicata\-feather\]\]/g, '<span class="mastilnitsata mastilnitsata-new-design-feather"></span>');
          }
           
          var preview = h('div', {},
            h('div', {'className': 'mt-3 ' + messageClass }, isHiddenText),
            h('div', { "style" : { "backgroundColor" : bgColor, "color": color  }, "className": "darksection " + css }, content)
          );
          return preview;
        }
      });
      CMS.registerPreviewTemplate("content-blocks", ContentBlockPreview);


      var AnimatedBannerPreview = createClass({
        render: function() {
          /*
          var entry = this.props.entry;
          var content = this.props.widgetFor('body');

          var bgColor = entry.getIn(['data', 'bg-color']);
          bgColor = (typeof(bgColor) == typeof(undefined))? 'transparent' : bgColor;
          var color = entry.getIn(['data', 'color']);
          color = (typeof(color) == typeof(undefined))? 'black' : color;
          var css = entry.getIn(['data', 'css-class']);
          css = (typeof(css) == typeof(undefined))? '' : css;

          var isHiddenText = 'This content block is ' + ((entry.getIn(['data', 'hidden']))? 'hidden':'visible!');
          var messageClass = ((entry.getIn(['data', 'hidden']))? 'hiddenPost':'visiblePost');

          
          if(content)
          {
            content.props.value = content.props.value.replace(/[\\]*\[\[mastilnicata\-logo\]\]/g, '<span class="mastilnitsata mastilnitsata-mastilnitsa-handmade"></span>');
            content.props.value = content.props.value.replace(/[\\]*\[\[mastilnicata\-m\]\]/g, '<span class="mastilnitsata mastilnitsata-mastilnitsa-handmade-M"></span>');
            content.props.value = content.props.value.replace(/[\\]*\[\[mastilnicata\-feather\]\]/g, '<span class="mastilnitsata mastilnitsata-new-design-feather"></span>');
          }*/
          return h('div', {}, "banner");
        }
      });
      CMS.registerPreviewTemplate("animated-banners", AnimatedBannerPreview);



      var colorpickerControl = createClass({
        handleChange: function(e) {
          this.props.onChange(e.target.value);
        },
      
        render: function() {
          var value = this.props.value;
          var ctl = h('div', {}, h('input', { type: 'color', value: value ? value : '', onChange: this.handleChange }), h('input', { type:'text', value: value ? value : '', onChange: this.handleChange }) );
          return ctl;
        }
      });
      
      var CategoriesPreview = createClass({
        render: function() {
          return h('ul', {},
            this.props.value.map(function(val, index) {
              return h('li', {key: index}, val);
            })
          );
        }
      });
      
      CMS.registerWidget('color-picker', colorpickerControl, CategoriesPreview);
    </script>
</body>